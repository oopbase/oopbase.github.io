
<!DOCTYPE html>
<html lang="en">
        <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

        <title>oopbase.de - Der F# JSON Type Provider</title>
        <meta name="description" content="oopbase.de" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">        

        <link type="application/rss+xml" rel="alternate" title="oopbase.de" href="/feed.rss" />
                <link type="application/atom+xml" rel="alternate" title="oopbase.de" href="/feed.atom" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">

        <link href="/assets/css/bootstrap.min.css" rel="stylesheet" />
        <link href="/assets/css/highlight.css" rel="stylesheet">
        <link href="/assets/css/clean-blog.css" rel="stylesheet" />
        <link href="/assets/css/master.css" rel="stylesheet" />
        <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
        <link href="/assets/css/override.css" rel="stylesheet" />


        <meta name="application-name" content="oopbase.de" />
        <meta name="msapplication-tooltip" content="oopbase.de" />
        <meta name="msapplication-starturl" content="/" />

        <meta property="og:title" content="oopbase.de - Der F# JSON Type Provider" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="http://oopbase.de/posts/fsharp-jsonprovider.html" />
        <!-- TODO: More social graph meta tags -->

        <script src="/assets/js/jquery.min.js"></script>
        <script src="/assets/js/bootstrap.min.js"></script>     
        <script src="/assets/js/highlight.pack.js"></script>   
        <script src="/assets/js/clean-blog.js"></script>
        <script src="/assets/js/d3.v3.min.js"></script>
        <script src="/assets/js/trianglify.min.js"></script>
        <script src="/assets/js/Please-compressed.js"></script>
        <script src="/assets/js/background-check.min.js"></script>
                
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
                <script src="/assets/js/html5shiv.js"></script>
                <script src="/assets/js/respond.min.js"></script>
        <![endif]-->
        
        


        </head>
        <body>
                
                <!-- Navigation -->
                <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
                        <div class="container-fluid">
                                <!-- Brand and toggle get grouped for better mobile display -->
                                <div class="navbar-header page-scroll">
                                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                                        <span class="sr-only">Toggle navigation</span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        </button>
                                        <a class="navbar-brand" href="/">oopbase.de</a>
                                </div>
                        
                                <!-- Collect the nav links, forms, and other content for toggling -->
                                <div class="collapse navbar-collapse" id="navbar-collapse">
                                        <ul class="nav navbar-nav navbar-right">
                                                        <li><a href="/posts">Archive</a></li>
        <li><a href="/tags">Tags</a></li>
        <li><a href="/privacy.html">Datenschutz</a></li>
        <li><a href="/imprint.html">Impressum</a></li>
 
                                        </ul>
                                </div>
                                <!-- /.navbar-collapse -->
                        </div>
                        <!-- /.container -->
                </nav>
                
                <!-- Page Header -->
                <header class="intro-header" id="intro-header" style="background-image: url(&quot;../images/jsonprovider/title.jpg&quot;)">
                        <div class="container">
                                <div class="row">
                                        <div class="col-md-12">

    
<div class="post-heading">
    <h1>Der F# JSON Type Provider</h1>
    <div class="meta">        
Published on 01 Februar 2017<br>    </div>
        <div class="tags">
                    <a role="button" href="/tags/api.html" class="btn btn-default btn-xs">api</a>
                    <a role="button" href="/tags/f%23.html" class="btn btn-default btn-xs">f#</a>
                    <a role="button" href="/tags/golem.html" class="btn btn-default btn-xs">golem</a>
                    <a role="button" href="/tags/json.html" class="btn btn-default btn-xs">json</a>
                    <a role="button" href="/tags/TypeProvider.html" class="btn btn-default btn-xs">TypeProvider</a>
        </div>     
</div>
                                        </div>
                                </div>
                        </div>
                </header>
                
                <!-- Main Content -->
                <div class="container">
                        <div class="row">
                                <div id="content" class="col-md-12">
                                        

<p>Im Laufe seiner Karriere befasst sich jeder Softwareentwickler früher oder später mit der Verarbeitung von JSON- oder XML-Dateien. Das Vorgehen ist dabei immer sehr ähnlich: Man analysiert die Struktur des zu verarbeitenden Dokuments, legt sich passende Model-Klassen an und überführt dann die Daten in die konkreten Objekte.</p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- PostAd -->
<p><ins class="adsbygoogle"
style="display:inline-block;width:728px;height:90px"
data-ad-client="ca-pub-6705605697246410"
data-ad-slot="8941596319"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>In diesem Artikel möchte ich zeigen, wie man mit dem F# JSON Type Provider die REST-Schnittstelle von dem IT-Magazin <a href="http://www.golem.de/">Golem</a> konsumieren kann und warum die Verarbeitung der Daten mit F# so komfortabel ist.</p>
<h2 id="die-golem-rest-schnittstelle">Die Golem REST-Schnittstelle</h2>
<p>Die REST-Schnittstelle von Golem bietet eine Vielzahl von Web-Services an, um z.B. Informationen zu den neusten Artikeln zu bekommen oder um in Kategorien nach bestimmten Begriffen zu suchen. Im folgenden Beispiel konzentriere ich mich auf das Anfragen der Neusten- und der Top-Artikel.</p>
<p>Die URL-Synopsis zur Anfrage der Artikel sieht wie folgt aus:</p>
<ul>
<li>ht<span>tp://api.golem.de/api/article/<em>ARTIKELTYP</em>/limit/?format=resultformat&amp;key=developerkey</li>
<li>ht<span>tp://api.golem.de/api/article/<em>ARTIKELTYP</em>/?format=resultformat&amp;key=developerkey</li>
</ul>
<p>Als Artikeltyp wird unterschieden zwischen <em>latest</em> und <em>top</em>. Über ein optionales <em>limit</em> kann festgelegt werden, wie viele Artikel maximal angefragt werden sollen. Als Parameter der Anfrage dienen ein Format, in dem das Ergebnis der Anfrage zurückgegeben werden soll (für das Beispiel also JSON) und ein DeveloperKey. Nach der <a href="http://api.golem.de/apimanage/index.php">Registrierung bei Golem</a> bekommt man zwei Developer-Keys zugesendet. Dies sind zum einen ein Test-Key, mit dem beliebig viele Anfragen geschickt werden können und zum anderen ein Personal-Key, mit dem nur eine gewisse Anzahl von Anfragen pro Stunde erlaubt ist. Bei Anfragen mit dem Test-Key werden immer die gleichen Daten angefragt (Lorem ipsum natürlich 😉), jedoch kann man sich so einen Überblick über die zu verarbeitende Struktur des JSON-Dokuments verschaffen.</p>
<h2 id="der-f-json-type-provider">Der F# JSON Type Provider</h2>
<p>Über den <a href="http://fsharp.github.io/FSharp.Data/library/JsonProvider.html">JSON Type Provider</a> bekommt man einen statisch typisierten Zugriff auf JSON-Dokumente. Dadurch müssen für die Verarbeitung eines JSON-Dokuments keine extra Datenhaltungsklassen angelegt werden, da diese durch den Type Provider implizit zur Verfügung gestellt werden. Der Type Provider bekommt ein Beispieldokument als Eingabe, welches die zu verarbeitende Struktur des JSON-Dokuments beinhaltet. Die passenden Typen werden dann vom Type Provider generiert. Was hier ein wenig wie schwarze Magie klingt, fühlt sich bei erster Verwendung auch tatsächlich so an 😁.</p>
<h2 id="f-wrapper-fur-golem-artikel">F# Wrapper für Golem Artikel</h2>
<p>Da jetzt alle nötigen Komponenten bekannt sind, können wir mit der eigentlichen Implementierung loslegen. Als erstes benötigen wir also für den JSON Type Provider die Struktur des JSON-Dokuments, welches wir bei Anfrage der Artikel zurückbekommen. Dafür rufen wir mit unseren Test-Key die folgende URL auf:</p>
<p>ht<span>tp://api.golem.de/api/article/latest/?format=json&amp;key=GEHEIMERTESTKEY</p>
<p>Das Ergebnis der Anfrage sollte dann in etwa so aussehen:</p>
<pre><code class="language-json">{
  &quot;data&quot;: [
    {
      &quot;articleid&quot;: 1,
      &quot;headline&quot;: &quot;Lorem ipsum dolor sit amet consectetuer sadipscing elitr sed&quot;,
      &quot;abstracttext&quot;:
        &quot;Lorem ipsum dolor sit amet, consectetuer sadipscing elitr...&quot;,
      &quot;url&quot;: &quot;http:\/\/api.golem.de\/&quot;,
      &quot;date&quot;: 123456789,
      &quot;leadimg&quot;: { &quot;url&quot;: &quot;http:\/\/api.golem.de\/img\/example_120.png&quot;, &quot;height&quot;: 90, &quot;width&quot;: 120 },
      &quot;comments&quot;: 12,
      &quot;images&quot;: 5
    }, {
      &quot;articleid&quot;: 1,
      &quot;headline&quot;: &quot;Lorem ipsum dolor sit amet consectetuer sadipscing elitr sed&quot;,
      &quot;abstracttext&quot;:
        &quot;Lorem ipsum dolor sit amet, consectetuer sadipscing elitr...&quot;,
      &quot;url&quot;: &quot;http:\/\/api.golem.de\/&quot;,
      &quot;date&quot;: 123456789,
      &quot;leadimg&quot;: { &quot;url&quot;: &quot;http:\/\/api.golem.de\/img\/example_120.png&quot;, &quot;height&quot;: 90, &quot;width&quot;: 120 },
      &quot;comments&quot;: 12,
      &quot;images&quot;: 5
    }
  ],
  &quot;success&quot;: true
}
</code></pre>
<p>Diesen Inhalt speichern wir nun als <em>article.json</em> ab.</p>
<p>Nun endlich der F# Code: Um typsicher zwischen den Neusten- und den Top-Artikeln unterscheiden zu können, legen wir uns für diesen Fall eine Discriminated Union an. Zusätlich implementieren wir eine Funktion, die einen Union Case dieser Discriminated Union entgegen nimmt und eine entsprechende String-Übersetzung zurückgibt.</p>
<pre><code class="language-fsharp">type ArticleType = | Latest | Top 

let asString = function
    | Latest -&gt; &quot;latest&quot;
    | Top -&gt; &quot;top&quot;
</code></pre>
<p>Anschließend legen wir einen neuen Typ namens <em>Article</em> an und initialisieren diesen als JSON Provider. Der statische Parameter, der an den JSON Provider übergeben wird, beschreibt den relativen Pfad zur Beispiel-JSON-Datei (In unserem Fall also das heruntergeladene Dokument).</p>
<pre><code class="language-fsharp">type Article = JsonProvider&lt;&quot;article.json&quot;&gt;
</code></pre>
<p>Nun benötigen wir lediglich die anzufragende URL sowie eine Funktion, welche die Anfragen kapselt.</p>
<pre><code class="language-fsharp">let [&lt;Literal&gt;] BaseUrl = &quot;http://api.golem.de/api/&quot;
let [&lt;Literal&gt;] ArticleUrl = BaseUrl + &quot;article/&quot;

let [&lt;Literal&gt;] RequestSuffix = &quot;/?format=json&amp;key=&quot;

let fetchArticles developerKey articleType (limit : option&lt;int&gt;) =
    let articleTypeAsString = articleType |&gt; asString
    let url =
        match limit with
        | Some data -&gt; ArticleUrl + articleTypeAsString + string(data) + RequestSuffix + developerKey
        | None -&gt; ArticleUrl + articleTypeAsString + RequestSuffix + developerKey
    Article.Load url
</code></pre>
<p>Abhängig davon, ob ein <em>limit</em> für die Artikel gesetzt wurde, wird die anzufragende URL zusammengebaut und anschließend über den Type Provider geladen und zurückgegeben (Für die C# Entwickler: das letzte Statement einer F# Funktion wird automatisch zurückgegeben).</p>
<p>Und das war's auch schon. Dies ist der komplette F#-Code, der nötig ist, um Artikel von der golem.de REST-Schnittstelle anzufragen und zu verarbeiten. Eine Beispielverwendung der Funktion zeigt der folgende Screenshot:</p>
<p><img src="../images/jsonprovider/screenshot.png" class="img-fluid" alt="Screenshot" /></p>
<p>Wie man sehen kann, wird über die Punktnotation typsicher auf das JSON Objekt zugegriffen. Dafür mussten keine Model-Klassen angelegt werden, da dies vom JSON Provider implizit übernommen wurde. Ähnliche Type Provider gibt es für <a href="http://fsharp.github.io/FSharp.Data/index.html">CSV-, XML- oder HTML-Dateien</a>. (Oder auch für <a href="http://pinksquirrellabs.com/post/2014/02/02/The-MineSweeper-Type-Provider.aspx">MineSweeper</a>, wenn man denn MineSweeper über die Punktnotation in der IDE via Intellisense spielen möchte 😁)</p>
<p>Das komplette Beispiel habe ich <a href="https://github.com/oopbase/fsharp-golem">bei GitHub hochgeladen</a>. Bei Fragen oder Anregungen, freue ich mich über eure Kommentare.</p>


<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'oopbase-de';
    var disqus_identifier = 'fsharp-jsonprovider';
    var disqus_title = 'Der F# JSON Type Provider';
    var disqus_url = 'http://oopbase.de/posts/fsharp-jsonprovider.html';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());

</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                                </div>
                        </div>
                </div>
                
                <hr>
                
                <!-- Footer -->
                <footer>
                        <div class="container">
        <div class="row">
                <div class="col-md-12">
                <ul class="list-inline text-center">
                        <li>
                        <a href="https://twitter.com/oopbase">
                                <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                        </li>
                        <li>
                        <a href="https://github.com/oopbase">
                                <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                        </li>
                </ul>
                <p class="copyright text-muted">
                        Copyright © 2017 by Marcel Schwark.
                        <br />
                        <a href="/feed.rss"><i class="fa fa-rss"></i> RSS Feed</a> | <a href="/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
                        <br />
                        <strong><a href="https://wyam.io">Generated by Wyam</a></strong>
                </p>
                </div>
        </div>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-22701184-1', 'auto');
  ga('send', 'pageview');

</script>
                </footer> 

                
                <script>hljs.initHighlightingOnLoad();</script>


                <script>
                        BackgroundCheck.init({
                                targets: '.intro-header,.navbar',
                                images: '.intro-header'
                        });
                </script>
        </body>
</html>

